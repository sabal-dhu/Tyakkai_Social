<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login | Tyakkai Social</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
    <link href="auth.css" rel="stylesheet">
    <!-- Load Google Identity Services library -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        /* Add error message styling */
        .error-message {
            background-color: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
            display: none;
        }
        
        /* Google Sign-In button container */
        #googleSignIn {
            width: 100%;
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="auth-container">
        <h2 class="auth-title">Login to Your Account</h2>
        <form class="auth-form" id="loginForm">
            <!-- Error message container -->
            <div class="error-message" id="errorMessage">
                Invalid email or password. Please try again.
            </div>
            
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="email" placeholder="Enter your email" required>
            </div>
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="password" placeholder="Enter your password" required>
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
        </form>
        <div class="social-login">
            <p class="social-text">Or login with</p>
            <!-- Google Sign-In button will be rendered here -->
            <div id="googleSignIn"></div>
            <button class="social-btn facebook-btn">
                <svg class="social-icon" viewBox="0 0 24 24" fill="#1877F2">
                    <!-- Facebook icon paths -->
                </svg>
                Facebook
            </button>
        </div>
        <p class="auth-footer">Don't have an account? <a href="register.html">Register</a></p>
    </div>

    <script>
        // Initialize Google Sign-In
        function initializeGoogleSignIn() {
            google.accounts.id.initialize({
                client_id: 'YOUR_CLIENT_ID.apps.googleusercontent.com', // Replace with your actual Client ID
                callback: handleGoogleResponse
            });
            
            // Render Google Sign-In button
            google.accounts.id.renderButton(
                document.getElementById("googleSignIn"),
                { 
                    theme: "outline", 
                    size: "large",
                    width: "100%",
                    text: "signin_with",
                    shape: "rectangular"
                }
            );
        }
        
        // Handle Google response
        function handleGoogleResponse(response) {
            console.log("Google response:", response);
            
            // Send the credential to your backend for verification
            fetch('/auth/google', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ token: response.credential })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    window.location.href = "/dashboard"; // Redirect on success
                } else {
                    document.getElementById('errorMessage').textContent = "Google login failed: " + data.error;
                    document.getElementById('errorMessage').style.display = 'block';
                }
            })
            .catch(err => {
                console.error("Error:", err);
                document.getElementById('errorMessage').textContent = "Error during Google login";
                document.getElementById('errorMessage').style.display = 'block';
            });
        }

        // Regular form login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Get input values
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            
            // Simple validation (replace with actual authentication logic)
            if (email === 'user@example.com' && password === 'password') {
                // Successful login - redirect to dashboard
                window.location.href = 'dashboard.html';
            } else {
                // Show error message
                document.getElementById('errorMessage').style.display = 'block';
                
                // Clear password field
                document.getElementById('password').value = '';
                
                // Hide error message after 3 seconds
                setTimeout(() => {
                    document.getElementById('errorMessage').style.display = 'none';
                }, 3000);
            }
        });
        
        // Initialize Google Sign-In when the page loads
        window.onload = initializeGoogleSignIn;
    </script>
</body>
</html>